library(aprof)

#### INITIAL STATE ####
source("./scripts/initialisation.R")
dump("generate.patches", file = "./scripts/A.R")
source("./scripts/A.R")
Rprof(file = "./profiling/A.out", interval = .02, line.profiling = TRUE)
generate.patches(bio1, n.patches = 50, patch.size = 10)
Rprof(append = FALSE)
# summaryRprof("./profiling/A.out")
sum.aprofA <- aprof("./scripts/A.R", "./profiling/A.out")
pdf("./profiling/A.pdf")
plot(sum.aprofA)
dev.off()
profileplot(sum.aprofA)
summary(sum.aprofA)

#### TEST 1: replace for by sapply ####
source("./scripts/initialisation.R")
source("./scripts/functions/patch_generation_version3.1.R")
dump("generate.patches", file = "./scripts/B.R")
source("./scripts/B.R")
Rprof(file = "./profiling/B.out", interval = .02, line.profiling = TRUE)
generate.patches(bio1, n.patches = 50, patch.size = 10)
Rprof(append = FALSE)
# summaryRprof("./profiling/B.out")
sum.aprofB <- aprof("./scripts/B.R", "./profiling/B.out")
pdf("./profiling/B.pdf")
plot(sum.aprofB)
dev.off()
profileplot(sum.aprofB)
summary(sum.aprofB)

#### TEST 2: replace sapply by lapply ####
source("./scripts/initialisation.R")
source("./scripts/functions/patch_generation_version3.2.R")
dump("generate.patches", file = "./scripts/C.R")
source("./scripts/C.R")
Rprof(file = "./profiling/C.out", interval = .02, line.profiling = TRUE)
generate.patches(bio1, n.patches = 50, patch.size = 10)
Rprof(append = FALSE)
# summaryRprof("./profiling/C.out")
sum.aprofC <- aprof("./scripts/C.R", "./profiling/C.out")
pdf("./profiling/C.pdf")
plot(sum.aprofC)
dev.off()
profileplot(sum.aprofC)
summary(sum.aprofC)

#### TEST 3: replace sapply by lapply AND replace rowSums by lapply(which)####
source("./scripts/initialisation.R")
source("./scripts/functions/patch_generation_version3.3.R")
dump("generate.patches", file = "./scripts/D.R")
source("./scripts/D.R")
Rprof(file = "./profiling/D.out", interval = .02, line.profiling = TRUE)
generate.patches(bio1, n.patches = 50, patch.size = 10)
Rprof(append = FALSE)
# summaryRprof("./profiling/D.out")
sum.aprofD <- aprof("./scripts/D.R", "./profiling/D.out")
pdf("./profiling/D.pdf")
plot(sum.aprofD)
dev.off()
profileplot(sum.aprofD)
summary(sum.aprofD)

#### TEST 4: kept loop, changed allocation in loop, changed NA condition in initial function ####
source("./scripts/initialisation.R")
source("./scripts/functions/patch_generation_version4.R")
dump("generate.patches", file = "./scripts/E.R")
source("./scripts/E.R")
Rprof(file = "./profiling/E.out", interval = .02, line.profiling = TRUE)
generate.patches(bio1, n.patches = 50, patch.size = 10)
Rprof(append = FALSE)
# summaryRprof("./profiling/E.out")
sum.aprofE <- aprof("./scripts/E.R", "./profiling/E.out")
pdf("./profiling/E.pdf")
plot(sum.aprofE)
dev.off()
profileplot(sum.aprofE)
summary(sum.aprofE)

#### TEST 5: TEST 4 with improved allocation in loop ####
source("./scripts/initialisation.R")
source("./scripts/functions/patch_generation_version4.1.R")
dump("generate.patches", file = "./scripts/F.R")
source("./scripts/F.R")
Rprof(file = "./profiling/F.out", interval = .02, line.profiling = TRUE)
generate.patches(bio1, n.patches = 50, patch.size = 10)
Rprof(append = FALSE)
# summaryRprof("./profiling/F.out")
sum.aprofF <- aprof("./scripts/F.R", "./profiling/F.out")
pdf("./profiling/F.pdf")
plot(sum.aprofF)
dev.off()
profileplot(sum.aprofF)
summary(sum.aprofF)

summary(sum.aprofA)
summary(sum.aprofB)
summary(sum.aprofC)
summary(sum.aprofD)
summary(sum.aprofE)
summary(sum.aprofF)