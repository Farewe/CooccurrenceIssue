library(aprof)
number.of.species <- 5000

#### INITIAL STATE ####
# source("./scripts/initialisation.R")
# source("./scripts/00 Initial code.R")
# dump("generatePatchySpecies", file = "./scripts/00.R")
# source("./scripts/00.R")
# Rprof(file = "./profiling/00.out", interval = .02, line.profiling = TRUE)
# generatePatchySpecies(nb.sim = 1, nb.sp = number.of.species)
# Rprof(append = FALSE)
# # summaryRprof("./profiling/00.out")
# sum.aprof00 <- aprof("./scripts/00.R", "./profiling/00.out")
# pdf("./profiling/00.pdf")
# plot(sum.aprof00)
# dev.off()
# profileplot(sum.aprof00)
# summary(sum.aprof00)

#### TEST 1 ####
source("./scripts/initialisation.R")
source("./scripts/functions/patch_generation_simplified.R")
source("./scripts/01 Modified patchy function.R")
dump("generatePatchySpecies2", file = "./scripts/01.R")
source("./scripts/01.R")
Rprof(file = "./profiling/01.out", interval = .02, line.profiling = TRUE)
generatePatchySpecies2(nb.sim = 1, nb.sp = number.of.species)
Rprof(append = FALSE)
# summaryRprof("./profiling/01.out")
sum.aprof01 <- aprof("./scripts/01.R", "./profiling/01.out")
pdf("./profiling/01.pdf")
plot(sum.aprof01)
dev.off()
profileplot(sum.aprof01)
summary(sum.aprof01)

#### TEST 2 ####
source("./scripts/initialisation.R")
source("./scripts/02 Modified generation method.R")
dump("generatePatchySpecies", file = "./scripts/02.R")
source("./scripts/02.R")
Rprof(file = "./profiling/02.out", interval = .02, line.profiling = TRUE)
generatePatchySpecies(nb.sim = 1, nb.sp = number.of.species)
Rprof(append = FALSE)
# summaryRprof("./profiling/02.out")
sum.aprof02 <- aprof("./scripts/02.R", "./profiling/02.out")
pdf("./profiling/02.pdf")
plot(sum.aprof02)
dev.off()
profileplot(sum.aprof02)
summary(sum.aprof02)

#### TEST 3 ####
source("./scripts/initialisation.R")
source("./scripts/functions/patch_generation_version3.R")
source("./scripts/02 Modified generation method.R")
dump("generatePatchySpecies", file = "./scripts/03.R")
source("./scripts/03.R")
Rprof(file = "./profiling/03.out", interval = .02, line.profiling = TRUE)
generatePatchySpecies(nb.sim = 1, nb.sp = number.of.species)
Rprof(append = FALSE)
# summaryRprof("./profiling/03.out")
sum.aprof03 <- aprof("./scripts/03.R", "./profiling/03.out")
pdf("./profiling/03.pdf")
plot(sum.aprof03)
dev.off()
profileplot(sum.aprof03)
summary(sum.aprof03)


#### TEST 4 ####
source("./scripts/initialisation.R")
source("./scripts/functions/patch_generation_version3.1.R")
source("./scripts/02 Modified generation method.R")
dump("generatePatchySpecies", file = "./scripts/04.R")
source("./scripts/04.R")
Rprof(file = "./profiling/04.out", interval = .02, line.profiling = TRUE)
generatePatchySpecies(nb.sim = 1, nb.sp = number.of.species)
Rprof(append = FALSE)
# summaryRprof("./profiling/04.out")
sum.aprof04 <- aprof("./scripts/04.R", "./profiling/04.out")
pdf("./profiling/04.pdf")
plot(sum.aprof04)
dev.off()
profileplot(sum.aprof04)
summary(sum.aprof04)

#### TEST 5 ####
source("./scripts/initialisation.R")
source("./scripts/functions/patch_generation_version4.1.R")
source("./scripts/02 Modified generation method.R")
dump("generatePatchySpecies", file = "./scripts/05.R")
source("./scripts/05.R")
Rprof(file = "./profiling/05.out", interval = .02, line.profiling = TRUE)
generatePatchySpecies(nb.sim = 1, nb.sp = number.of.species)
Rprof(append = FALSE)
# summaryRprof("./profiling/05.out")
sum.aprof05 <- aprof("./scripts/05.R", "./profiling/05.out")
pdf("./profiling/05.pdf")
plot(sum.aprof05)
dev.off()
profileplot(sum.aprof05)
summary(sum.aprof05)

#### TEST 5 ####
source("./scripts/initialisation.R")
source("./scripts/functions/patch_generation_version4.1.R")
source("./scripts/06 Modified generation method v2.R")
dump("generatePatchySpecies", file = "./scripts/06.R")
source("./scripts/06.R")
Rprof(file = "./profiling/06.out", interval = .02, line.profiling = TRUE)
generatePatchySpecies(nb.sim = 1, nb.sp = number.of.species)
Rprof(append = FALSE)
# summaryRprof("./profiling/06.out")
sum.aprof06 <- aprof("./scripts/06.R", "./profiling/06.out")
pdf("./profiling/06.pdf")
plot(sum.aprof06)
dev.off()
profileplot(sum.aprof06)
summary(sum.aprof06)

#### TEST 6 ####
library(foreach)
source("./scripts/initialisation.R")
source("./scripts/functions/patch_generation_version4.1.R")
source("./scripts/functions/growDistribution.R")
source("./scripts/functions/resamp.R")
source("./scripts/07 Parallel generation based on 06.R")
dump("generatePatchySpecies", file = "./scripts/07.R")
source("./scripts/07.R")
library(doParallel)
registerDoParallel(cores=8)
Rprof(file = "./profiling/07.out", interval = .02, line.profiling = TRUE)
generatePatchySpecies(nb.sim = 2, nb.sp = number.of.species)
Rprof(append = FALSE)
# summaryRprof("./profiling/07.out")
sum.aprof07 <- aprof("./scripts/07.R", "./profiling/07.out")
pdf("./profiling/07.pdf")
plot(sum.aprof07)
dev.off()
profileplot(sum.aprof07)
summary(sum.aprof07)

summary(sum.aprof00) #42.94
summary(sum.aprof01) #76.54 (but misleading)
summary(sum.aprof02) #115.76
summary(sum.aprof03) #135.86
summary(sum.aprof04) #135.34
summary(sum.aprof05) #105.96
summary(sum.aprof06) #105.8
summary(sum.aprof07) #40.2
